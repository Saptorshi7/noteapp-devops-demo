trigger:
- develop

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: AzureLoginAndTerraform
  displayName: 'Azure Login + Terraform Stage'
  jobs:
  # -----------------------
  # Job 1: Azure Login
  # -----------------------
  - job: LoginJob
    displayName: 'Run az login'
    steps:
    - task: AzureCLI@2
      displayName: 'Azure CLI Login'
      inputs:
        azureSubscription: 'AzureDevOpsSubscription'  # Replace with your service connection name
        scriptType: bash
        scriptLocation: inlineScript
        inlineScript: |
          echo "‚úÖ Successfully logged in with service connection."
          az account show --output table

  # -----------------------
  # Job 2: Install Terraform
  # -----------------------
  - job: TerraformInstallJob
    displayName: 'Install Terraform'
    dependsOn: LoginJob
    steps:
    - task: Bash@3
      displayName: 'Install Terraform'
      inputs:
        targetType: 'inline'
        script: |
          echo "‚¨áÔ∏è Installing Terraform..."
          sudo apt-get update -y
          sudo apt-get install -y wget unzip
          TERRAFORM_VERSION="1.9.8"  # üîß Change version if needed
          wget https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip
          unzip terraform_${TERRAFORM_VERSION}_linux_amd64.zip
          sudo mv terraform /usr/local/bin/
          terraform -version
